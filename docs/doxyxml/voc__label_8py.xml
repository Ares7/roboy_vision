<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="voc__label_8py" kind="file" language="Python">
    <compoundname>voc_label.py</compoundname>
    <innernamespace refid="namespacevoc__label">voc_label</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">import</highlight><highlight class="normal"><sp/>xml.etree.ElementTree<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>ET</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>pickle</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>os<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>listdir,<sp/>getcwd</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>os.path<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>join</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal">sets=[(</highlight><highlight class="stringliteral">&apos;2012&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;train&apos;</highlight><highlight class="normal">),<sp/>(</highlight><highlight class="stringliteral">&apos;2012&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;val&apos;</highlight><highlight class="normal">),<sp/>(</highlight><highlight class="stringliteral">&apos;2007&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;train&apos;</highlight><highlight class="normal">),<sp/>(</highlight><highlight class="stringliteral">&apos;2007&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;val&apos;</highlight><highlight class="normal">),<sp/>(</highlight><highlight class="stringliteral">&apos;2007&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;test&apos;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal">classes<sp/>=<sp/>[</highlight><highlight class="stringliteral">&quot;aeroplane&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;bicycle&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;bird&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;boat&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;bottle&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;bus&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;car&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;cat&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;chair&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;cow&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;diningtable&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;dog&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;horse&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;motorbike&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;person&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pottedplant&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;sheep&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;sofa&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;train&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;tvmonitor&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">convert(size,<sp/>box):</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/>dw<sp/>=<sp/>1./(size[0])</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/>dh<sp/>=<sp/>1./(size[1])</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>x<sp/>=<sp/>(box[0]<sp/>+<sp/>box[1])/2.0<sp/>-<sp/>1</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/>y<sp/>=<sp/>(box[2]<sp/>+<sp/>box[3])/2.0<sp/>-<sp/>1</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>w<sp/>=<sp/>box[1]<sp/>-<sp/>box[0]</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>h<sp/>=<sp/>box[3]<sp/>-<sp/>box[2]</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>x<sp/>=<sp/>x*dw</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>w<sp/>=<sp/>w*dw</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/>y<sp/>=<sp/>y*dh</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/>h<sp/>=<sp/>h*dh</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(x,y,w,h)</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">convert_annotation(year,<sp/>image_id):</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>in_file<sp/>=<sp/>open(</highlight><highlight class="stringliteral">&apos;VOCdevkit/VOC%s/Annotations/%s.xml&apos;</highlight><highlight class="normal">%(year,<sp/>image_id))</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/>out_file<sp/>=<sp/>open(</highlight><highlight class="stringliteral">&apos;VOCdevkit/VOC%s/labels/%s.txt&apos;</highlight><highlight class="normal">%(year,<sp/>image_id),<sp/></highlight><highlight class="stringliteral">&apos;w&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/>tree=ET.parse(in_file)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/>root<sp/>=<sp/>tree.getroot()</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>size<sp/>=<sp/>root.find(</highlight><highlight class="stringliteral">&apos;size&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/>w<sp/>=<sp/>int(size.find(</highlight><highlight class="stringliteral">&apos;width&apos;</highlight><highlight class="normal">).text)</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/>h<sp/>=<sp/>int(size.find(</highlight><highlight class="stringliteral">&apos;height&apos;</highlight><highlight class="normal">).text)</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>obj<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>root.iter(</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>difficult<sp/>=<sp/>obj.find(</highlight><highlight class="stringliteral">&apos;difficult&apos;</highlight><highlight class="normal">).text</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cls<sp/>=<sp/>obj.find(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">).text</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cls<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>classes<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>int(difficult)==1:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cls_id<sp/>=<sp/>classes.index(cls)</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xmlbox<sp/>=<sp/>obj.find(</highlight><highlight class="stringliteral">&apos;bndbox&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b<sp/>=<sp/>(float(xmlbox.find(</highlight><highlight class="stringliteral">&apos;xmin&apos;</highlight><highlight class="normal">).text),<sp/>float(xmlbox.find(</highlight><highlight class="stringliteral">&apos;xmax&apos;</highlight><highlight class="normal">).text),<sp/>float(xmlbox.find(</highlight><highlight class="stringliteral">&apos;ymin&apos;</highlight><highlight class="normal">).text),<sp/>float(xmlbox.find(</highlight><highlight class="stringliteral">&apos;ymax&apos;</highlight><highlight class="normal">).text))</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bb<sp/>=<sp/>convert((w,h),<sp/>b)</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out_file.write(str(cls_id)<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">.join([str(a)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>a<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>bb])<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal">wd<sp/>=<sp/>getcwd()</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>year,<sp/>image_set<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>sets:</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>os.path.exists(</highlight><highlight class="stringliteral">&apos;VOCdevkit/VOC%s/labels/&apos;</highlight><highlight class="normal">%(year)):</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os.makedirs(</highlight><highlight class="stringliteral">&apos;VOCdevkit/VOC%s/labels/&apos;</highlight><highlight class="normal">%(year))</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>image_ids<sp/>=<sp/>open(</highlight><highlight class="stringliteral">&apos;VOCdevkit/VOC%s/ImageSets/Main/%s.txt&apos;</highlight><highlight class="normal">%(year,<sp/>image_set)).read().strip().split()</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>list_file<sp/>=<sp/>open(</highlight><highlight class="stringliteral">&apos;%s_%s.txt&apos;</highlight><highlight class="normal">%(year,<sp/>image_set),<sp/></highlight><highlight class="stringliteral">&apos;w&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>image_id<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>image_ids:</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list_file.write(</highlight><highlight class="stringliteral">&apos;%s/VOCdevkit/VOC%s/JPEGImages/%s.jpg\n&apos;</highlight><highlight class="normal">%(wd,<sp/>year,<sp/>image_id))</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>convert_annotation(year,<sp/>image_id)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>list_file.close()</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal">os.system(</highlight><highlight class="stringliteral">&quot;cat<sp/>2007_train.txt<sp/>2007_val.txt<sp/>2012_train.txt<sp/>2012_val.txt<sp/>&gt;<sp/>train.txt&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="58"><highlight class="normal">os.system(</highlight><highlight class="stringliteral">&quot;cat<sp/>2007_train.txt<sp/>2007_val.txt<sp/>2007_test.txt<sp/>2012_train.txt<sp/>2012_val.txt<sp/>&gt;<sp/>train.all.txt&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/home/ubuntu/workspace/roboy_vision/src/pyyolo/darknet/scripts/voc_label.py"/>
  </compounddef>
</doxygen>
